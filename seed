#!groovy
def urlka='sheriff1021/d323dsl'
job ('seed'){
parameters {
	    choiceParam('BRANCH_NAME', ['volodya', 'master'], 'Branch name')
	    activeChoiceParam('CHOICER') {
					 choiceType('CHECKBOX')
					 groovyScript {script('''list = []
								 for(i in 1..4){
							         list.add("children${i}-job")
  									       }
								return list''')													      																				
}
	}

steps {
        downstreamParameterized {
           			 trigger('$CHOICER') {	
                			  		 block {
                    			   			 buildStepFailure('FAILURE')
                    			   	 		 failure('FAILURE')
                    			   	 		 unstable('UNSTABLE')
                     			   	               }
							 parameters {
                    						predefinedProp('BRANCH_NAME', '$BRANCH_NAME')
						    	             }
				}
	}

for (int i=0; i<4;i++) {
			job ("children${i}-job") {
						scm {
    							git {
         							remote {
                								github(urlka)
                							}
								branch('$BRANCH_NAME')
       			   	 	    		    }
   		   	 	   		     }
						parameters {
               					 	activeChoiceParam('BRANCH_NAME') {
                   					 description('Choose branch')
                   					 filterable(false)
                   					 choiceType('SINGLE_SELECT')
                   					 groovyScript {
                      					  script('("git ls-remote -h https://github.com/sheriff1021/d323dsl").execute().text.readLines().collect { it.split()[1].replaceAll(\'refs/heads/\', 									    \'\')}.unique()')
                  						      }
wrappers {
                preBuildCleanup {
                    deleteDirectories(false)
                    cleanupParameter()
                }
            }              							    			  }
steps {
                shell('''sh script.sh > output.txt; tar -czvf "$BRANCH_NAME"_dsl_script.tar.gz''')
            }         						   }
publishers {
                archiveArtifacts {
                    pattern('output.txt, ${BRANCH_NAME}_dsl_script.tar.gz')

                }

						 }
} 
}}}}

